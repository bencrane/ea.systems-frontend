<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>my.ea.systems</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: black;
            color: white;
            min-height: 100vh;
            font-family: system-ui, -apple-system, sans-serif;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }
        .login-screen .login-box {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
        }
        .login-screen h1 {
            margin-bottom: 2rem;
            font-size: 2rem;
        }
        .login-screen input {
            display: block;
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            border: 1px solid #333;
            background: #111;
            color: white;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        .login-screen input::placeholder {
            color: #666;
        }
        .login-screen input:focus {
            outline: none;
            border-color: #fff;
        }
        .login-screen button {
            width: 100%;
            padding: 1rem 2rem;
            font-size: 1rem;
            background: white;
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .login-screen button:hover {
            background: #ddd;
        }
        .login-screen button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .error {
            color: #ff6b6b;
            margin-bottom: 1rem;
            display: none;
        }

        /* App Layout */
        .app-layout {
            display: none;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 260px;
            background: #0a0a0a;
            border-right: 1px solid #1a1a1a;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            margin-bottom: 1rem;
        }
        .sidebar-logo {
            width: 32px;
            height: 32px;
            background: white;
            color: black;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }
        .sidebar-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .sidebar-nav {
            flex: 1;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            border-radius: 6px;
            color: #888;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 0.9rem;
        }
        .nav-item:hover {
            background: #1a1a1a;
            color: white;
        }
        .nav-item.active {
            background: #1a1a1a;
            color: white;
        }
        .nav-item svg {
            width: 18px;
            height: 18px;
            opacity: 0.7;
        }
        .nav-item.active svg {
            opacity: 1;
        }

        .nav-section {
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            padding: 0 0.75rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sidebar-footer {
            border-top: 1px solid #1a1a1a;
            padding-top: 1rem;
            margin-top: 1rem;
        }
        .sidebar-footer .nav-item {
            margin-bottom: 0.25rem;
        }
        .sidebar-email {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            color: #555;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 2rem;
            min-height: 100vh;
        }
        .main-header {
            margin-bottom: 2rem;
        }
        .main-header h1 {
            font-size: 1.75rem;
            margin-bottom: 0.25rem;
        }
        .main-header p {
            color: #666;
        }

        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        .system-card {
            background: #111;
            border: 1px solid #222;
            border-radius: 8px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .system-card:hover {
            border-color: #444;
            background: #151515;
        }
        .system-card h3 {
            font-size: 1rem;
            margin-bottom: 0.375rem;
        }
        .system-card p {
            font-size: 0.875rem;
            color: #666;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="login-screen" id="login">
        <div class="login-box">
            <h1>my.ea.systems</h1>
            <form id="loginForm">
                <input type="email" id="emailInput" placeholder="Email" required>
                <input type="password" id="passwordInput" placeholder="Password" required>
                <p class="error" id="error"></p>
                <button type="submit" id="submitBtn">Login</button>
            </form>
        </div>
    </div>

    <div class="app-layout" id="appLayout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">E</div>
                <span class="sidebar-title">Everything Automation</span>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item active" data-page="dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" rx="1"/>
                        <rect x="14" y="3" width="7" height="7" rx="1"/>
                        <rect x="3" y="14" width="7" height="7" rx="1"/>
                        <rect x="14" y="14" width="7" height="7" rx="1"/>
                    </svg>
                    Dashboard
                </div>

                <div class="nav-section">Workspace</div>
                <div class="nav-item" data-page="systems">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M3 7h18M3 12h18M3 17h18"/>
                        <rect x="6" y="5" width="4" height="4" rx="1"/>
                        <rect x="6" y="10" width="4" height="4" rx="1"/>
                        <rect x="6" y="15" width="4" height="4" rx="1"/>
                    </svg>
                    Systems
                </div>

                <div class="nav-section">Account</div>
                <div class="nav-item" data-page="billing">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="5" width="20" height="14" rx="2"/>
                        <path d="M2 10h20"/>
                    </svg>
                    Billing
                </div>
                <div class="nav-item" data-page="settings">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Settings
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <path d="M12 17h.01"/>
                    </svg>
                    Help & Support
                </div>
                <div class="sidebar-email">team@everythingautomation.com</div>
            </div>
        </aside>

        <main class="main-content">
            <div class="main-header">
                <h1>Welcome, <span id="userName"></span></h1>
                <p id="userEmail"></p>
            </div>

            <div class="systems-grid" id="systemsContainer"></div>
        </main>
    </div>

    <script>
        const API_BASE = 'https://api.serviceengine.xyz';
        const CHAT_URL = '/chat';

        const loginScreen = document.getElementById('login');
        const appLayout = document.getElementById('appLayout');
        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const submitBtn = document.getElementById('submitBtn');
        const errorEl = document.getElementById('error');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const systemsContainer = document.getElementById('systemsContainer');

        // Check if already logged in
        const savedUser = localStorage.getItem('ea_user');
        if (savedUser) {
            showDashboard(JSON.parse(savedUser));
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorEl.style.display = 'none';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Logging in...';

            try {
                const response = await fetch(`${API_BASE}/public/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: emailInput.value.trim(),
                        password: passwordInput.value
                    })
                });

                if (!response.ok) {
                    throw new Error('Invalid credentials');
                }

                const userData = await response.json();
                localStorage.setItem('ea_user', JSON.stringify(userData));
                showDashboard(userData);
            } catch (err) {
                errorEl.textContent = err.message || 'Login failed';
                errorEl.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Login';
            }
        });

        // Nav item click handlers
        document.querySelectorAll('.nav-item[data-page]').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                const page = item.dataset.page;
                if (page === 'settings') {
                    // Logout for now
                    localStorage.removeItem('ea_user');
                    loginScreen.style.display = 'flex';
                    appLayout.style.display = 'none';
                    emailInput.value = '';
                    passwordInput.value = '';
                }
            });
        });

        function showDashboard(user) {
            loginScreen.style.display = 'none';
            appLayout.style.display = 'block';

            userName.textContent = user.name || 'User';
            userEmail.textContent = user.email;

            systemsContainer.innerHTML = '';
            if (user.systems && user.systems.length > 0) {
                user.systems.forEach(system => {
                    const card = document.createElement('div');
                    card.className = 'system-card';
                    card.innerHTML = `
                        <h3>${system.name}</h3>
                        <p>${system.description || ''}</p>
                    `;
                    card.addEventListener('click', () => {
                        const params = new URLSearchParams({
                            system: system.name,
                            slug: system.slug
                        });
                        window.location.href = `${CHAT_URL}?${params.toString()}`;
                    });
                    systemsContainer.appendChild(card);
                });
            } else {
                systemsContainer.innerHTML = '<p style="color: #666;">No systems available</p>';
            }
        }
    </script>
</body>
</html>
